<!DOCTYPE html>
<html>
<head>
    <title>Field Report - {{ field_report.id }}</title>
    <meta charset="utf-8">
    <style>
        /* Base Styles */
        body {
            font-family: Arial, sans-serif;
            font-size: 10pt;
            margin: 0.5in; /* Standard margin for printing */
        }

        /* Headers and Titles */
        h1 {
            color: #007bff;
            border-bottom: 3px solid #007bff;
            padding-bottom: 5px;
            margin-top: 0;
            font-size: 18pt;
        }
        h2 {
            color: #333;
            margin-top: 25px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            font-size: 14pt;
        }

        /* Section Styling */
        .section {
            margin-bottom: 20px;
            border: 1px solid #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
            /* CRITICAL: Prevents content from being cut off mid-section */
            page-break-inside: avoid;
        }

        /* Data Points */
        .data-point {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        .data-point strong {
            display: inline-block;
            width: 150px; /* Aligns the data labels */
            color: #555;
        }

        /* Summary Text */
        .summary-box {
            /* CRITICAL: Preserves new lines and spacing from the database */
            white-space: pre-wrap;
            margin-top: 10px;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: #fff;
            min-height: 50px;
        }

        /* Badges/Status Indicators */
        .badge-status {
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 9pt;
            color: white;
            background-color: #28a745;
        }
        .badge-status.danger { background-color: #dc3545; }
        .badge-status.warning { background-color: #ffc107; color: black; }

        /* Footer */
        .footer {
            text-align: right;
            margin-top: 50px;
            font-size: 8pt;
            color: #666;
            /* This helps place the footer consistently */
            position: fixed;
            bottom: 0;
            right: 0;
            left: 0;
            padding: 10px 0.5in 0;
        }
    </style>
</head>
<body>

    <h1>Field Report: {{ field_report.assignment.field_job.client_name }}</h1>

    <p style="font-size: 11pt; color: #555;">
        Submitted by **{{ field_report.assignment.staff.get_full_name }}** on **{{ field_report.submitted_at|date:"F j, Y, H:i" }}**
    </p>

    <div class="section">
        <h2>1. Job & Personnel Information</h2>
        <div class="data-point"><strong>Client Name:</strong> {{ field_report.assignment.field_job.client_name }}</div>
        <div class="data-point"><strong>Category:</strong> {{ field_report.assignment.field_job.category }}</div>
        <div class="data-point"><strong>Date of Job:</strong> {{ field_report.assignment.field_job.date_of_job|date:"F j, Y" }}</div>
        <div class="data-point"><strong>Site Address:</strong> {{ field_report.assignment.field_job.site_address }}</div>
        <div class="data-point"><strong>POC Name:</strong> {{ field_report.assignment.field_job.poc_name }}</div>
        <div class="data-point"><strong>Field Engineer:</strong> {{ field_report.assignment.staff.get_full_name }}</div>
    </div>

    <div class="section">
        <h2>2. Time & Location Tracking</h2>
        <div class="data-point">
            <strong>Check In:</strong>
            {{ field_report.check_in_time|date:"H:i:s"|default:"N/A" }}
        </div>
        <div class="data-point">
            <strong>Check Out:</strong>
            {{ field_report.check_out_time|date:"H:i:s"|default:"N/A" }}
        </div>
        <div class="data-point">
            <strong>Total Hours:</strong>
            {{ field_report.hours_worked|floatformat:2|default:"N/C" }} hrs
        </div>
        <div class="data-point">
            <strong>Submission Address:</strong>
            {{ field_report.submission_location_address|default:"N/A" }}
        </div>
        <div class="data-point">
            <strong>Submission Coords:</strong>
            (Lat: {{ field_report.submission_location_lat }}, Lng: {{ field_report.submission_location_lng }})
        </div>
    </div>

    <div class="section">
        <h2>3. Work Summary</h2>
        <div class="data-point"><strong>Original Job Scope:</strong></div>
        <div class="summary-box">{{ field_report.assignment.field_job.summary_of_work|default:"Not Provided" }}</div>

        <div class="data-point" style="margin-top: 15px;"><strong>Work Performed by FE:</strong></div>
        <div class="summary-box">{{ field_report.summary_of_work_performed|default:"Not Provided" }}</div>
    </div>

    <div class="section">
        <h2>4. Conclusion & Signatures</h2>
        <div class="data-point">
            <strong>Site Visit Complete:</strong>
            {% if field_report.site_visit_complete %}
                <span class="badge-status">Yes</span>
            {% else %}
                <span class="badge-status danger">No</span>
            {% endif %}
        </div>
        <div class="data-point">
            <strong>Revisit Required:</strong>
            {% if field_report.revisit_required %}
                <span class="badge-status warning">Yes</span>
            {% else %}
                <span class="badge-status">No</span>
            {% endif %}
        </div>
        <div class="data-point">
            <strong>FE Signature:</strong> {{ field_report.fe_signature|default:"None Recorded" }}
        </div>
        <div class="data-point">
            <strong>POC Code Used:</strong>
            {% if field_report.assignment.is_code_used %}
                 <span class="badge-status">Yes</span>
            {% else %}
                 <span class="badge-status danger">No</span>
            {% endif %}
        </div>
    </div>

    <div class="footer">
        Generated by {{ user.get_full_name }} (Admin) on {{ now|date:"Y-m-d H:i" }}
    </div>

</body>
</html>