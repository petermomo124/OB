{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load humanize %}

{% block title %}
    {% trans "Report Detail" %} - {{ field_report.assignment.field_job.client_name }}
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-lg-10">
            <div class="card shadow-lg border-0 bg-white rounded-4">

                <div class="card-header bg-primary text-white p-4 rounded-top-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="card-title mb-0 h3">
                                <i class="fas fa-file-invoice me-2"></i>
                                {% trans "Detailed Field Report" %}
                            </h1>
                            <p class="mb-0 opacity-75">{{ field_report.assignment.field_job.client_name }} - {{ field_report.submitted_at|date:"F j, Y" }}</p>
                        </div>
                        <a href="{% if request.user.role == 'admin' %}{% url 'fieldwork:field_job_list' %}{% else %}{% url 'fieldwork:staff_field_jobs' %}{% endif %}"
                           class="btn btn-light btn-sm d-none d-md-inline-block text-primary fw-bold">
                            <i class="fas fa-arrow-left me-1"></i> {% trans "Back to Jobs" %}
                        </a>
                    </div>
                </div>

                <div class="card-body p-4 p-md-5">

                    <div class="status-ribbon mb-5 shadow">
                        <i class="fas fa-clipboard-check me-3"></i>
                        <div>
                            <h5 class="mb-0">{% trans "Report Submitted & Approved" %}</h5>
                            <small>{% trans "Finalized and submitted" %} **{{ field_report.submitted_at|naturaltime }}**.</small>
                        </div>
                    </div>

                    <div class="row g-4 mb-5">
                        <div class="col-12 col-md-6">
                            <div class="card h-100 border-start border-4 border-info shadow-sm bg-light-info">
                                <div class="card-body">
                                    <h5 class="mb-3 text-info"><i class="fas fa-map-pin me-2"></i> {% trans "Job Site Details" %}</h5>
                                    <p class="mb-2 text-wrap-break"><strong>{% trans "Client" %}:</strong> {{ field_report.assignment.field_job.client_name }}</p>
                                    <p class="mb-2"><strong>{% trans "Category" %}:</strong> {{ field_report.assignment.field_job.category }}</p>
                                    <p class="mb-2"><strong>{% trans "Date" %}:</strong> {{ field_report.assignment.field_job.date_of_job }}</p>
                                    <p class="mb-0 text-wrap-break"><strong>{% trans "Site Address" %}:</strong> {{ field_report.assignment.field_job.site_address }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="card h-100 border-start border-4 border-warning shadow-sm bg-light-warning">
                                <div class="card-body">
                                    <h5 class="mb-3 text-warning"><i class="fas fa-id-badge me-2"></i> {% trans "Field Engineer Info" %}</h5>
                                    <p class="mb-2"><strong>{% trans "Name" %}:</strong> {{ field_report.assignment.staff.get_full_name }}</p>
                                    <p class="mb-2"><strong>{% trans "Staff ID" %}:</strong> {{ field_report.assignment.staff.id }}</p>
                                    <p class="mb-2"><strong>{% trans "POC Name" %}:</strong> {{ field_report.assignment.field_job.poc_name }}</p>
                                    <p class="mb-0"><strong>{% trans "FE Signature" %}:</strong> {{ field_report.fe_signature|default:"Not provided" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-5">
                        <div class="col-12 col-lg-4">
                            <div class="card h-100 border-success border-3 shadow">
                                <div class="card-body text-center">
                                    <h5 class="mb-3 text-success"><i class="fas fa-hourglass-half me-2"></i> {% trans "Time & Effort" %}</h5>
                                    <h2 class="display-6 fw-bold text-success">{{ field_report.hours_worked|floatformat:2|default:"N/C" }}</h2>
                                    <p class="mb-3 text-muted">{% trans "Total Hours Worked" %}</p>
                                    <hr>
                                    <small class="d-block text-start">
                                        <i class="fas fa-sign-in-alt text-success me-1"></i> {% trans "In" %}: {{ field_report.check_in_time|date:"H:i"|default:"N/A" }}
                                    </small>
                                    <small class="d-block text-start">
                                        <i class="fas fa-sign-out-alt text-danger me-1"></i> {% trans "Out" %}: {{ field_report.check_out_time|date:"H:i"|default:"N/A" }}
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-lg-8">
                            <div class="card h-100 border-0 shadow">
                                <div class="card-header bg-light border-bottom-0">
                                    <h6 class="mb-0 text-primary"><i class="fas fa-clipboard-list me-2"></i> {% trans "Work Summary" %}</h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-3 border-bottom pb-2">
                                        <strong class="d-block text-muted small text-uppercase">{% trans "Original Job Scope" %}:</strong>
                                        <span class="text-wrap-break">{{ field_report.assignment.field_job.summary_of_work|default:"Not provided" }}</span>
                                    </p>
                                    <p class="mb-0">
                                        <strong class="d-block text-muted small text-uppercase">{% trans "FE Work Performed" %}:</strong>
                                        <span class="text-wrap-break">{{ field_report.summary_of_work_performed|default:"Not provided" }}</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-4 mb-5">
                        <div class="col-12 col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0 text-dark"><i class="fas fa-poll me-2"></i> {% trans "Final Status" %}</h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2 d-flex justify-content-between">
                                        <strong>{% trans "Site Visit Complete" %}:</strong>
                                        {% if field_report.site_visit_complete %}
                                            <span class="badge bg-success py-2 px-3"><i class="fas fa-check-circle me-1"></i> {% trans "Yes" %}</span>
                                        {% else %}
                                            <span class="badge bg-danger py-2 px-3"><i class="fas fa-times-circle me-1"></i> {% trans "No" %}</span>
                                        {% endif %}
                                    </p>
                                    <p class="mb-0 d-flex justify-content-between">
                                        <strong>{% trans "Revisit Required" %}:</strong>
                                        {% if field_report.revisit_required %}
                                            <span class="badge bg-warning text-dark py-2 px-3"><i class="fas fa-exclamation-triangle me-1"></i> {% trans "Yes" %}</span>
                                        {% else %}
                                            <span class="badge bg-success py-2 px-3"><i class="fas fa-check-circle me-1"></i> {% trans "No" %}</span>
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0 text-dark"><i class="fas fa-location-arrow me-2"></i> {% trans "Submission Geo-Tag" %}</h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2">
                                        <strong class="d-block text-muted small text-uppercase">{% trans "Address" %}:</strong>
                                        <span class="text-wrap-break">{{ field_report.submission_location_address|default:"N/A" }}</span>
                                    </p>
                                    <p class="mb-3">
                                        <strong class="d-block text-muted small text-uppercase">{% trans "Coordinates" %}:</strong>
                                        <code class="bg-light p-1 rounded d-inline-block">Lat: {{ field_report.submission_location_lat|default:"N/A" }}, Lng: {{ field_report.submission_location_lng|default:"N/A" }}</code>
                                    </p>
                                    {% if field_report.submission_location_lat and field_report.submission_location_lng %}
                                    <a href="https://maps.google.com/maps?q={{ field_report.submission_location_lat }},{{ field_report.submission_location_lng }}"
                                       target="_blank" class="btn btn-outline-primary w-100 btn-sm">
                                        <i class="fas fa-street-view me-1"></i> {% trans "View Geo-location on Map" %}
                                    </a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between pt-3 border-top">
                        <a href="{% if request.user.role == 'admin' %}{% url 'fieldwork:field_job_list' %}{% else %}{% url 'fieldwork:staff_field_jobs' %}{% endif %}"
                           class="btn btn-secondary rounded-pill px-4">
                           <i class="fas fa-arrow-left me-1"></i> {% trans "Back" %}
                        </a>

                        {% if request.user.role == 'admin' %}
                        <button id="exportPdfBtn" data-url="{% url 'fieldwork:field_report_export_pdf' field_report.id %}" class="btn btn-primary rounded-pill px-4 action-button">
                            <i class="fas fa-file-word me-2"></i> <span class="button-text">{% trans "Export Docx" %}</span>
                            <div class="loading-spinner d-none"></div>
                        </button>
                        {% endif %}
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<style>
/* --- Custom Color Palette & General Design --- */
:root {
    --bs-primary: #007bff;
    --bs-success: #28a745;
    --bs-warning: #ffc107;
    --bs-info: #17a2b8;
    --bs-secondary: #6c757d;
    --bs-light-info: #e0f7fa;
    --bs-light-warning: #fff8e1;
    --bs-danger: #dc3545;
    --bs-dark: #212529;
    --bs-light: #f8f9fa;
}

/* Base Container Improvements */
.container {
    max-width: 100%;
    padding-left: 0.75rem;
    padding-right: 0.75rem;
    overflow-x: hidden;
}

.container.py-4 {
    padding-top: 1rem !important;
    padding-bottom: 1rem !important;
}

/* Rounded corners for the entire card */
.rounded-4 {
    border-radius: 1rem !important;
}

.rounded-top-4 {
    border-radius: 1rem 1rem 0 0 !important;
}

/* Light background for subtle cards */
.bg-light-info {
    background-color: var(--bs-light-info) !important;
}

.bg-light-warning {
    background-color: var(--bs-light-warning) !important;
}

/* Comprehensive Text Wrapping */
.text-wrap-break {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    width: 100% !important;
}

/* Card and Layout Improvements */
.card {
    width: 100%;
    overflow: hidden;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

.card-header {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

.card-title {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.2;
    width: 100%;
}

.card-body {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    width: 100%;
}

/* Submission Status Ribbon Style */
.status-ribbon {
    background: linear-gradient(45deg, var(--bs-success), #198754);
    color: white;
    padding: 1.25rem;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    border: 2px solid #fff;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    width: 100%;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

.status-ribbon h5 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
    margin-bottom: 0.25rem !important;
}

.status-ribbon small {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
    opacity: 0.9;
}

/* Custom code block style for coordinates */
code {
    font-size: 0.85rem;
    color: var(--bs-dark);
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
    width: 100%;
    display: inline-block;
}

/* Button Improvements */
.btn {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    text-align: center;
    line-height: 1.3;
}

.rounded-pill {
    border-radius: 50rem !important;
}

/* Badge Improvements */
.badge {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.2;
    text-align: center;
    min-width: fit-content;
}

/* Display Text Improvements */
.display-6 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.1;
}

/* Text and Paragraph Improvements */
p {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
    width: 100%;
}

strong {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

.text-muted {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

.text-uppercase {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    letter-spacing: 0.5px;
}

/* Flex Container Improvements */
.d-flex {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

.justify-content-between {
    width: 100%;
}

/* Grid System Improvements */
.row {
    width: 100%;
    margin-left: 0;
    margin-right: 0;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

.col-12, .col-md-6, .col-lg-8, .col-lg-4, .col-lg-10 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    padding-left: 0.5rem;
    padding-right: 0.5rem;
}

/* Border and Shadow Improvements */
.border-start {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

.shadow, .shadow-sm, .shadow-lg {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

/* Icon Alignment */
.fas, .fa {
    flex-shrink: 0;
}

.d-flex.align-items-center .fas,
.d-flex.align-items-center .fa {
    margin-right: 0.5rem;
}

/* --- Beautiful State Loading Animation --- */
.action-button {
    position: relative;
    overflow: hidden;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

.loading-spinner {
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #ffffff;
    border-radius: 50%;
    animation: spin 1s ease-in-out infinite;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: none;
}

@keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

.action-button.loading .button-text {
    visibility: hidden;
}

.action-button.loading .loading-spinner {
    display: block !important;
}

/* Emergency Text Break Classes */
.break-anywhere {
    word-break: break-all !important;
    overflow-wrap: anywhere !important;
}

.text-container {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    width: 100%;
}

/* Specific Element Improvements */
.h3, .h5, .h6 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.2;
}

.opacity-75 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

.border-bottom {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

.pb-2 {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
}

/* Link Improvements */
a {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

/* HR Improvements */
hr {
    margin: 0.75rem 0;
    opacity: 0.25;
}

/* ------------------ Mobile-Specific Styles ------------------ */
@media (max-width: 768px) {
    .container {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }

    .container.py-4 {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
    }

    .card-body.p-4.p-md-5 {
        padding: 1rem !important;
    }

    .card-header.bg-primary.text-white.p-4 {
        padding: 1rem !important;
    }

    /* Header Improvements for Mobile */
    .card-header .d-flex {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    .card-title.mb-0.h3 {
        font-size: 1.25rem !important;
        line-height: 1.3 !important;
    }

    .card-header p.mb-0.opacity-75 {
        font-size: 0.9rem;
        line-height: 1.2;
    }

    /* Status Ribbon Mobile Improvements */
    .status-ribbon {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
        gap: 0.5rem;
    }

    .status-ribbon i {
        font-size: 1.5rem !important;
        margin-right: 0 !important;
    }

    .status-ribbon h5 {
        font-size: 1rem !important;
    }

    .status-ribbon small {
        font-size: 0.8rem;
    }

    /* Card Layout Mobile Improvements */
    .row.g-4.mb-5 {
        margin-bottom: 2rem !important;
    }

    .row.g-4 {
        gap: 1rem !important;
    }

    .col-12.col-md-6,
    .col-12.col-lg-4,
    .col-12.col-lg-8 {
        margin-bottom: 1rem;
    }

    /* Time & Effort Card Mobile */
    .display-6 {
        font-size: 2rem !important;
    }

    /* Work Summary Mobile */
    .card-body p.mb-3.border-bottom.pb-2 {
        padding-bottom: 0.75rem !important;
        margin-bottom: 0.75rem !important;
    }

    /* Final Status Mobile */
    .d-flex.justify-content-between {
        flex-direction: column;
        gap: 0.5rem;
        align-items: flex-start;
    }

    .d-flex.justify-content-between .badge {
        align-self: flex-start;
    }

    /* Submission Geo-Tag Mobile */
    .btn.btn-outline-primary.w-100.btn-sm {
        margin-top: 0.5rem;
    }

    /* Footer Buttons Mobile */
    .d-flex.justify-content-between.pt-3.border-top {
        flex-direction: column;
        gap: 1rem;
        padding-top: 1rem !important;
    }

    .d-flex.justify-content-between .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }

    /* Hide desktop back button on mobile */
    .btn.btn-light.btn-sm.d-none.d-md-inline-block {
        display: none !important;
    }
}

/* For very small screens */
@media (max-width: 576px) {
    .container {
        padding-left: 0.25rem;
        padding-right: 0.25rem;
    }

    .card-body.p-4.p-md-5 {
        padding: 0.75rem !important;
    }

    .card-header.bg-primary.text-white.p-4 {
        padding: 0.75rem !important;
    }

    .status-ribbon {
        padding: 0.75rem;
    }

    .status-ribbon h5 {
        font-size: 0.9rem !important;
    }

    .status-ribbon small {
        font-size: 0.75rem;
    }

    .card-title.mb-0.h3 {
        font-size: 1.1rem !important;
    }

    .h5, .h6 {
        font-size: 0.9rem !important;
    }

    .display-6 {
        font-size: 1.75rem !important;
    }

    .btn {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }

    .btn-lg {
        padding: 0.75rem 1.25rem;
        font-size: 1rem;
    }

    .badge {
        font-size: 0.75rem;
        padding: 0.35rem 0.65rem;
    }

    /* Stack all cards on very small screens */
    .row.g-4 .col-12 {
        margin-bottom: 0.75rem;
    }

    /* Reduce spacing */
    .mb-5 {
        margin-bottom: 2rem !important;
    }

    .mb-3 {
        margin-bottom: 1rem !important;
    }

    .mb-2 {
        margin-bottom: 0.5rem !important;
    }
}

/* Extra Small Screens */
@media (max-width: 400px) {
    .container {
        padding-left: 0.15rem;
        padding-right: 0.15rem;
    }

    .card-body.p-4.p-md-5 {
        padding: 0.5rem !important;
    }

    .card-header.bg-primary.text-white.p-4 {
        padding: 0.5rem !important;
    }

    .status-ribbon {
        padding: 0.5rem;
    }

    .btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.85rem;
    }

    .rounded-pill {
        border-radius: 1rem !important;
    }

    /* Single column layout for everything */
    .row.g-4 {
        margin-left: 0;
        margin-right: 0;
    }

    .col-12 {
        padding-left: 0.25rem;
        padding-right: 0.25rem;
    }
}

/* Large Screen Optimizations */
@media (min-width: 1200px) {
    .container {
        max-width: 1400px;
        margin: 0 auto;
    }

    .col-lg-10 {
        max-width: 1200px;
    }
}

/* Print Styles */
@media print {
    .btn,
    .action-button,
    .status-ribbon i {
        display: none !important;
    }

    .card {
        box-shadow: none !important;
        border: 1px solid #ccc !important;
    }

    .status-ribbon {
        background: #f8f9fa !important;
        color: #000 !important;
        border: 1px solid #ccc !important;
    }

    /* Ensure text readability in print */
    .text-muted {
        color: #666 !important;
    }

    .bg-primary {
        background-color: #f8f9fa !important;
        color: #000 !important;
    }
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
    .border-info {
        border-color: #000 !important;
    }

    .border-warning {
        border-color: #000 !important;
    }

    .border-success {
        border-color: #000 !important;
    }

    .text-info {
        color: #000 !important;
    }

    .text-warning {
        color: #000 !important;
    }

    .text-success {
        color: #000 !important;
    }
}

/* Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
    .loading-spinner {
        animation: none;
    }

    .btn {
        transition: none;
    }
}

/* Focus Styles for Accessibility */
.btn:focus-visible,
a:focus-visible {
    outline: 2px solid var(--bs-primary);
    outline-offset: 2px;
}

/* Ensure All Images Are Responsive */
img {
    max-width: 100%;
    height: auto;
}

/* Prevent Horizontal Scrolling */
body {
    overflow-x: hidden;
    width: 100%;
}

/* Final Safety Nets */
* {
    max-width: 100%;
    box-sizing: border-box;
}

/* Specific Fixes for Long Text Scenarios */
.client-name-long,
.site-address-long,
.work-summary-long {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    line-height: 1.4 !important;
    width: 100% !important;
}

/* Coordinate Display Improvements */
.coordinate-display {
    font-family: 'Courier New', monospace;
    background-color: var(--bs-light);
    padding: 0.5rem;
    border-radius: 0.375rem;
    word-break: break-all;
    font-size: 0.8rem;
}

/* Loading State Improvements for Export Button */
.action-button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}

/* Icon Size Consistency */
.fas, .fa {
    width: 1em;
    height: 1em;
}

/* Text Alignment Classes */
.text-start, .text-center, .text-end {
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const exportBtn = document.getElementById('exportPdfBtn');

    if (exportBtn) {
        exportBtn.addEventListener('click', function(e) {
            e.preventDefault();

            const button = this;
            const url = button.getAttribute('data-url');

            // 1. Activate Loading State
            button.classList.add('loading');
            button.disabled = true;

            // 2. Simulate/Initiate PDF Export
            // NOTE: In a real-world scenario, you'd use a fetch request here
            // to hit your Django view that generates the PDF.
            console.log("Initiating PDF export to:", url);

            // Using a simple timeout to simulate network latency for the animation
            setTimeout(() => {
                // If the PDF export is successful, you typically redirect or trigger a file download.
                // For this template, we just redirect directly to the URL to start the download.
                window.location.href = url;

                // 3. Deactivate Loading State after a short delay (or upon actual download start/failure)
                // We keep it loading briefly even after redirection for a better user experience.
                setTimeout(() => {
                    button.classList.remove('loading');
                    button.disabled = false;
                }, 500);

            }, 2000); // 2 seconds simulation delay
        });
    }
});
</script>
{% endblock %}