{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Display Messages -->
    {% if messages %}
    <div class="mb-4">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            <i class="fas
                {% if message.tags == 'success' %}fa-check-circle
                {% elif message.tags == 'error' %}fa-exclamation-circle
                {% elif message.tags == 'warning' %}fa-exclamation-triangle
                {% else %}fa-info-circle{% endif %}
            "></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h2 class="card-title mb-0">
                        <i class="fas fa-clipboard-list me-2"></i>
                        {% if field_job %}Edit{% else %}Create{% endif %} Field Job
                    </h2>
                    <span class="badge bg-info fs-6">
                        <i class="fas fa-users me-1"></i>
                        Available Staff: {{ staff_count }}
                    </span>
                </div>
                <div class="card-body">
                    <form method="post" id="fieldJobForm" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                {% for error in form.non_field_errors %}
                                    {{ error }}
                                {% endfor %}
                            </div>
                        {% endif %}

                        <!-- Basic Information Section -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-info-circle me-2 text-primary"></i>
                                Basic Information
                            </h5>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.category.id_for_label }}" class="form-label">
                                            <i class="fas fa-tag me-1 text-muted"></i>Category *
                                        </label>
                                        {{ form.category }}
                                        {% if form.category.errors %}
                                            <div class="text-danger small mt-1">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ form.category.errors }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.date_of_job.id_for_label }}" class="form-label">
                                            <i class="fas fa-calendar me-1 text-muted"></i>Date & Time of Job *
                                        </label>
                                        {{ form.date_of_job }}
                                        {% if form.date_of_job.errors %}
                                            <div class="text-danger small mt-1">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ form.date_of_job.errors }}
                                            </div>
                                        {% endif %}
                                        <div class="form-text">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Job must be scheduled for a future date and time
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.site_address.id_for_label }}" class="form-label">
                                    <i class="fas fa-map-marker-alt me-1 text-muted"></i>Site Address *
                                </label>
                                {{ form.site_address }}
                                {% if form.site_address.errors %}
                                    <div class="text-danger small mt-1">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ form.site_address.errors }}
                                    </div>
                                {% endif %}
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.summary_of_work.id_for_label }}" class="form-label">
                                    <i class="fas fa-file-alt me-1 text-muted"></i>Summary of Work *
                                </label>
                                {{ form.summary_of_work }}
                                {% if form.summary_of_job.errors %}
                                    <div class="text-danger small mt-1">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ form.summary_of_work.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Client Information Section -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-building me-2 text-primary"></i>
                                Client Information
                            </h5>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.client_name.id_for_label }}" class="form-label">
                                            <i class="fas fa-user-tie me-1 text-muted"></i>Client Name *
                                        </label>
                                        {{ form.client_name }}
                                        {% if form.client_name.errors %}
                                            <div class="text-danger small mt-1">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ form.client_name.errors }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.poc_name.id_for_label }}" class="form-label">
                                            <i class="fas fa-user me-1 text-muted"></i>POC Name *
                                        </label>
                                        {{ form.poc_name }}
                                        {% if form.poc_name.errors %}
                                            <div class="text-danger small mt-1">
                                                <i class="fas fa-exclamation-circle me-1"></i>
                                                {{ form.poc_name.errors }}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="{{ form.poc_email.id_for_label }}" class="form-label">
                                    <i class="fas fa-envelope me-1 text-muted"></i>POC Email *
                                </label>
                                {{ form.poc_email }}
                                {% if form.poc_email.errors %}
                                    <div class="text-danger small mt-1">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ form.poc_email.errors }}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Staff Selection Section -->
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2 mb-3">
                                <i class="fas fa-users me-2 text-primary"></i>
                                Staff Assignment
                            </h5>

                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Note:</strong> Selected staff will receive email notifications and POC approval codes will be sent to the client.
                            </div>

                            <!-- Search and Controls -->
                            <div class="row align-items-end mb-3">
                                <div class="col-md-8">
                                    <label for="staff_search" class="form-label">Search Staff</label>
                                    <input type="text" id="staff_search" class="form-control" placeholder="Type staff name or email to search...">
                                    <div class="form-text">Start typing to filter staff members</div>
                                </div>
                                <div class="col-md-4">
                                    <div class="d-grid">
                                        <button type="button" id="clear_search" class="btn btn-outline-secondary">
                                            <i class="fas fa-times me-1"></i>Clear Search
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Selection Stats -->
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="text-muted small" id="selection_stats">
                                    <span id="selected_count">0</span> of <span id="total_count">{{ staff_count }}</span> staff selected
                                </span>
                                <span class="text-muted small" id="visible_stats">
                                    <span id="visible_count">{{ staff_count }}</span> staff visible
                                </span>
                            </div>

                            <!-- Staff Checkboxes Container -->
                            <div id="staff_checkboxes_container" class="border rounded p-3 bg-light" style="max-height: 400px; overflow-y: auto;">
                                {% for checkbox in form.staff_members %}
                                    <div class="form-check staff-checkbox-item mb-2" data-staff-name="{{ checkbox.choice_label|lower }}">
                                        {{ checkbox.tag }}
                                        <label class="form-check-label staff-name" for="{{ checkbox.id_for_label }}">
                                            {{ checkbox.choice_label }}
                                        </label>
                                    </div>
                                {% empty %}
                                    <div class="text-center text-muted py-3">
                                        <i class="fas fa-users fa-2x mb-2"></i>
                                        <p>No staff members available.</p>
                                    </div>
                                {% endfor %}
                            </div>

                            {% if form.staff_members.errors %}
                                <div class="text-danger small mt-2">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    {{ form.staff_members.errors }}
                                </div>
                            {% endif %}

                            <div class="form-text mt-2">
                                <i class="fas fa-exclamation-circle me-1"></i>
                                Select at least one staff member to assign to this field job
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center border-top pt-4">
                            <a href="{% url 'fieldwork:field_job_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Back to List
                            </a>
                            <div>
                                <button type="reset" class="btn btn-outline-danger me-2">
                                    <i class="fas fa-undo me-1"></i>Reset Form
                                </button>
                                <button type="submit" class="btn btn-primary" id="submitBtn">
                                    <i class="fas fa-{% if field_job %}save{% else %}plus{% endif %} me-1"></i>
                                    {% if field_job %}Update{% else %}Create{% endif %} Field Job
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const staffSearch = document.getElementById('staff_search');
    const clearSearchBtn = document.getElementById('clear_search');
    const staffCheckboxesContainer = document.getElementById('staff_checkboxes_container');
    const staffCheckboxItems = document.querySelectorAll('.staff-checkbox-item');
    const selectedCountEl = document.getElementById('selected_count');
    const visibleCountEl = document.getElementById('visible_count');
    const totalCountEl = document.getElementById('total_count');
    const form = document.getElementById('fieldJobForm');
    const submitBtn = document.getElementById('submitBtn');
    const dateOfJobInput = document.getElementById('id_date_of_job');

    // Store all staff items for reset functionality
    const allStaffItems = Array.from(staffCheckboxItems);
    let visibleItems = allStaffItems;

    // Set minimum datetime for the date picker (current datetime)
    function setMinDateTime() {
        const now = new Date();
        // Format: YYYY-MM-DDTHH:MM
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');

        const minDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;

        if (dateOfJobInput) {
            dateOfJobInput.setAttribute('min', minDateTime);

            // If no value is set, set it to the minimum allowed (current time)
            if (!dateOfJobInput.value) {
                dateOfJobInput.value = minDateTime;
            }
        }
    }

    // Validate date and time on form submission
    function validateDateTime() {
        if (!dateOfJobInput || !dateOfJobInput.value) {
            return { isValid: false, message: 'Please select a date and time for the job.' };
        }

        const selectedDateTime = new Date(dateOfJobInput.value);
        const now = new Date();

        if (selectedDateTime < now) {
            return {
                isValid: false,
                message: 'Job date and time cannot be in the past. Please select a future date and time.'
            };
        }

        // Additional validation: cannot be more than 1 year in the future
        const oneYearFromNow = new Date();
        oneYearFromNow.setFullYear(now.getFullYear() + 1);

        if (selectedDateTime > oneYearFromNow) {
            return {
                isValid: false,
                message: 'Job date cannot be more than 1 year in the future.'
            };
        }

        return { isValid: true };
    }

    // Real-time date validation
    if (dateOfJobInput) {
        dateOfJobInput.addEventListener('change', function() {
            const validation = validateDateTime();
            if (!validation.isValid) {
                showAlert(validation.message, 'warning');
                // Reset to minimum allowed datetime
                setMinDateTime();
            }
        });

        dateOfJobInput.addEventListener('input', function() {
            const validation = validateDateTime();
            const dateTimeGroup = this.closest('.mb-3');
            const errorElement = dateTimeGroup.querySelector('.datetime-error');

            if (errorElement) {
                errorElement.remove();
            }

            if (!validation.isValid) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'text-danger small mt-1 datetime-error';
                errorDiv.innerHTML = `<i class="fas fa-exclamation-circle me-1"></i>${validation.message}`;
                dateTimeGroup.appendChild(errorDiv);
            }
        });
    }

    // Initialize counts
    function updateCounts() {
        const selectedCount = staffCheckboxesContainer.querySelectorAll('input[type="checkbox"]:not(#select_all_staff):checked').length;
        const visibleCount = visibleItems.filter(item => item.style.display !== 'none').length;

        selectedCountEl.textContent = selectedCount;
        visibleCountEl.textContent = visibleCount;
        totalCountEl.textContent = allStaffItems.length;

        // Update submit button state
        submitBtn.disabled = selectedCount === 0;
        if (submitBtn.disabled) {
            submitBtn.title = 'Please select at least one staff member';
        } else {
            submitBtn.title = '';
        }
    }

    // Search functionality
    function performSearch() {
        const query = staffSearch.value.trim().toLowerCase();
        visibleItems = [];

        allStaffItems.forEach(item => {
            const staffName = item.getAttribute('data-staff-name');
            const staffLabel = item.querySelector('.staff-name').textContent.toLowerCase();

            if (query.length === 0 || staffName.includes(query) || staffLabel.includes(query)) {
                item.style.display = 'block';
                visibleItems.push(item);
            } else {
                item.style.display = 'none';
            }
        });

        updateCounts();
    }

    staffSearch.addEventListener('input', performSearch);

    // Clear search functionality
    clearSearchBtn.addEventListener('click', function() {
        staffSearch.value = '';
        performSearch();
        staffSearch.focus();
    });

    // Select All / Deselect All functionality
    const selectAllContainer = document.createElement('div');
    selectAllContainer.className = 'mb-3 p-2 bg-white rounded border';
    selectAllContainer.innerHTML = `
        <div class="form-check">
            <input type="checkbox" id="select_all_staff" class="form-check-input">
            <label class="form-check-label fw-bold text-primary" for="select_all_staff">
                <i class="fas fa-check-double me-1"></i>Select All / Deselect All Visible Staff
            </label>
        </div>
    `;

    staffCheckboxesContainer.insertBefore(selectAllContainer, staffCheckboxesContainer.firstChild);

    // Select All functionality
    const selectAllCheckbox = document.getElementById('select_all_staff');
    selectAllCheckbox.addEventListener('change', function() {
        const visibleCheckboxes = visibleItems
            .filter(item => item.style.display !== 'none')
            .map(item => item.querySelector('input[type="checkbox"]'));

        visibleCheckboxes.forEach(checkbox => {
            if (checkbox) {
                checkbox.checked = this.checked;
            }
        });
        updateCounts();
    });

    // Update Select All checkbox state when individual checkboxes change
    staffCheckboxesContainer.addEventListener('change', function(e) {
        if (e.target.type === 'checkbox' && e.target.id !== 'select_all_staff') {
            const visibleCheckboxes = visibleItems
                .filter(item => item.style.display !== 'none')
                .map(item => item.querySelector('input[type="checkbox"]'))
                .filter(checkbox => checkbox !== null);

            const checkedVisibleCheckboxes = visibleCheckboxes.filter(checkbox => checkbox.checked);

            selectAllCheckbox.checked = checkedVisibleCheckboxes.length === visibleCheckboxes.length;
            selectAllCheckbox.indeterminate = checkedVisibleCheckboxes.length > 0 && checkedVisibleCheckboxes.length < visibleCheckboxes.length;

            updateCounts();
        }
    });

    // Form validation
    form.addEventListener('submit', function(e) {
        // Validate staff selection
        const checkedCheckboxes = staffCheckboxesContainer.querySelectorAll('input[type="checkbox"]:not(#select_all_staff):checked');

        if (checkedCheckboxes.length === 0) {
            e.preventDefault();
            showAlert('Please select at least one staff member to assign to this field job.', 'warning');
            return false;
        }

        // Validate date and time
        const dateTimeValidation = validateDateTime();
        if (!dateTimeValidation.isValid) {
            e.preventDefault();
            showAlert(dateTimeValidation.message, 'warning');
            dateOfJobInput.focus();
            return false;
        }
    });

    // Reset form handler
    form.addEventListener('reset', function() {
        setTimeout(() => {
            performSearch();
            updateCounts();
            // Reset Select All checkbox
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
            // Reset datetime to current
            setMinDateTime();
        }, 100);
    });

    // Alert function
    function showAlert(message, type = 'info') {
        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        // Insert at the top of the card body
        const cardBody = document.querySelector('.card-body');
        cardBody.insertBefore(alertDiv, cardBody.firstChild);

        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.remove();
            }
        }, 5000);
    }

    // Initialize counts and Select All state
    function initializeSelectAllState() {
        const visibleCheckboxes = visibleItems
            .filter(item => item.style.display !== 'none')
            .map(item => item.querySelector('input[type="checkbox"]'))
            .filter(checkbox => checkbox !== null);

        const checkedVisibleCheckboxes = visibleCheckboxes.filter(checkbox => checkbox.checked);

        if (checkedVisibleCheckboxes.length === visibleCheckboxes.length) {
            selectAllCheckbox.checked = true;
            selectAllCheckbox.indeterminate = false;
        } else if (checkedVisibleCheckboxes.length > 0) {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = true;
        } else {
            selectAllCheckbox.checked = false;
            selectAllCheckbox.indeterminate = false;
        }

        updateCounts();
    }

    // Initialize datetime picker
    setMinDateTime();

    // Call initialization
    setTimeout(initializeSelectAllState, 100);

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl + / to focus search
        if (e.ctrlKey && e.key === '/') {
            e.preventDefault();
            staffSearch.focus();
        }
    });
});
</script>
<style>
/* ===== VARIABLES & RESET ===== */
:root {
    --primary-color: #4361ee;
    --primary-dark: #3a56d4;
    --secondary-color: #7209b7;
    --success-color: #28a745;
    --warning-color: #ffc107;
    --danger-color: #dc3545;
    --info-color: #17a2b8;
    --light-color: #f8f9fa;
    --dark-color: #212529;
    --gray-color: #6c757d;
    --border-color: #dee2e6;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.15);
    --radius: 12px;
    --radius-sm: 8px;
    --transition: all 0.3s ease;
}

* {
    box-sizing: border-box;
}

/* ===== BASE STYLES ===== */
.container-fluid {
    padding-left: 1rem;
    padding-right: 1rem;
    overflow-x: hidden;
}

.container-fluid.py-4 {
    padding-top: 1.5rem !important;
    padding-bottom: 1.5rem !important;
}

/* ===== ALERT STYLES ===== */
.alert {
    border-radius: var(--radius-sm);
    border: none;
    box-shadow: var(--shadow);
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
    font-weight: 500;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.5;
}

.alert-success {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    color: #155724;
    border-left: 4px solid var(--success-color);
}

.alert-danger {
    background: linear-gradient(135deg, #f8d7da, #f1b0b7);
    color: #721c24;
    border-left: 4px solid var(--danger-color);
}

.alert-warning {
    background: linear-gradient(135deg, #fff3cd, #ffeaa7);
    color: #856404;
    border-left: 4px solid var(--warning-color);
}

.alert-info {
    background: linear-gradient(135deg, #d1ecf1, #b8e2eb);
    color: #0c5460;
    border-left: 4px solid var(--info-color);
}

.alert .btn-close {
    padding: 0.75rem;
}

/* ===== CARD STYLES ===== */
.card {
    border: none;
    box-shadow: var(--shadow-lg);
    border-radius: var(--radius);
    overflow: hidden;
    background: white;
    margin-bottom: 2rem;
}

.card-header {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
    border-bottom: none;
    padding: 1.5rem 2rem;
    position: relative;
    overflow: hidden;
}

.card-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
}

.card-header:hover::before {
    transform: translateX(100%);
}

.card-title {
    color: white;
    font-weight: 700;
    font-size: 1.5rem;
    margin: 0;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

.card-body {
    padding: 2rem;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

.badge {
    font-size: 0.875rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    box-shadow: var(--shadow);
}

.badge.bg-info {
    background: linear-gradient(135deg, #17a2b8, #138496) !important;
    border: none;
}

/* ===== FORM STYLES ===== */
.form-label {
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: var(--dark-color);
    font-size: 0.95rem;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label i {
    font-size: 1rem;
    width: 20px;
    text-align: center;
}

.form-control, .form-select {
    border: 2px solid #e9ecef;
    border-radius: var(--radius-sm);
    padding: 0.875rem 1rem;
    font-size: 1rem;
    transition: var(--transition);
    background-color: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.5;
}

.form-control:focus, .form-select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
    background-color: white;
}

.form-text {
    font-size: 0.875rem;
    color: var(--gray-color);
    margin-top: 0.5rem;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
}

.form-text i {
    margin-top: 0.125rem;
    flex-shrink: 0;
}

/* ===== SECTION HEADERS ===== */
.border-bottom {
    border-color: #e9ecef !important;
}

h5 {
    font-weight: 700;
    color: var(--dark-color);
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.3;
}

h5.border-bottom {
    padding-bottom: 1rem;
    margin-bottom: 1.5rem;
    font-size: 1.25rem;
}

/* ===== STAFF SELECTION STYLES ===== */
#staff_checkboxes_container {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border: 2px dashed #dee2e6;
    border-radius: var(--radius);
    padding: 1.5rem;
    max-height: 400px;
    overflow-y: auto;
    position: relative;
}

/* Custom Scrollbar */
#staff_checkboxes_container::-webkit-scrollbar {
    width: 8px;
}

#staff_checkboxes_container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

#staff_checkboxes_container::-webkit-scrollbar-thumb {
    background: var(--primary-color);
    border-radius: 4px;
}

#staff_checkboxes_container::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}

.staff-checkbox-item {
    padding: 1rem 1.25rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
    border: 2px solid transparent;
    background: white;
    margin-bottom: 0.75rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    cursor: pointer;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
}

.staff-checkbox-item:hover {
    border-color: var(--primary-color);
    box-shadow: 0 4px 8px rgba(67, 97, 238, 0.15);
    transform: translateY(-2px);
}

.staff-checkbox-item:has(input:checked) {
    background: linear-gradient(135deg, #e7f1ff, #d4e4ff);
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(67, 97, 238, 0.2);
}

.form-check-input {
    width: 1.2em;
    height: 1.2em;
    border: 2px solid #dee2e6;
    margin-right: 0.75rem;
    margin-top: 0.2em;
    cursor: pointer;
}

.form-check-input:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='m6 10 3 3 6-6'/%3e%3c/svg%3e");
}

.form-check-label {
    font-weight: 600;
    color: var(--dark-color);
    cursor: pointer;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
}

/* Select All Container */
#staff_checkboxes_container .form-check:first-child {
    background: linear-gradient(135deg, #fff, #f8f9fa);
    border: 2px solid var(--primary-color);
    margin-bottom: 1rem;
    padding: 1rem;
    border-radius: var(--radius-sm);
}

#staff_checkboxes_container .form-check:first-child .form-check-label {
    color: var(--primary-color);
    font-weight: 700;
    font-size: 1rem;
}

/* ===== SEARCH & CONTROLS ===== */
#staff_search {
    border-radius: var(--radius-sm);
    border: 2px solid #e9ecef;
    padding: 0.875rem 1rem;
    font-size: 1rem;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
}

#staff_search:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
}

#clear_search {
    border-radius: var(--radius-sm);
    font-weight: 600;
    padding: 0.875rem 1rem;
    border: 2px solid var(--gray-color);
    transition: var(--transition);
}

#clear_search:hover {
    background-color: var(--gray-color);
    color: white;
    transform: translateY(-1px);
}

/* Stats Display */
#selection_stats, #visible_stats {
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    background: white;
    border-radius: var(--radius-sm);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#selected_count {
    color: var(--success-color);
    font-weight: 700;
}

#visible_count {
    color: var(--primary-color);
    font-weight: 700;
}

/* ===== BUTTON STYLES ===== */
.btn {
    border-radius: var(--radius-sm);
    font-weight: 600;
    padding: 0.875rem 1.75rem;
    font-size: 1rem;
    transition: var(--transition);
    border: 2px solid transparent;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    text-align: center;
    line-height: 1.3;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
    border: none;
    box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    border: none;
    box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
}

.btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
    background: linear-gradient(135deg, #5a6268, #6c757d);
}

.btn-outline-danger {
    border-color: var(--danger-color);
    color: var(--danger-color);
    background: transparent;
}

.btn-outline-danger:hover {
    background: var(--danger-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
}

/* ===== FORM ACTIONS ===== */
.border-top {
    border-color: #e9ecef !important;
    padding-top: 2rem !important;
}

/* ===== ERROR STYLES ===== */
.text-danger {
    color: var(--danger-color) !important;
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    word-wrap: break-word;
    word-break: break-word;
    overflow-wrap: break-word;
    white-space: normal;
    line-height: 1.4;
}

.text-danger i {
    margin-top: 0.125rem;
    flex-shrink: 0;
}

/* ===== EMPTY STATE ===== */
.text-center.text-muted {
    padding: 3rem 2rem;
    color: var(--gray-color) !important;
}

.text-center.text-muted i {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.text-center.text-muted p {
    font-size: 1.1rem;
    margin: 0;
    font-weight: 500;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    .container-fluid {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }

    .container-fluid.py-4 {
        padding-top: 1rem !important;
        padding-bottom: 1rem !important;
    }

    .card-body {
        padding: 1.5rem;
    }

    .card-header {
        padding: 1.25rem 1.5rem;
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    .card-title {
        font-size: 1.25rem;
        line-height: 1.2;
    }

    .badge {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
        align-self: center;
    }

    /* Form adjustments */
    .form-control, .form-select {
        padding: 0.75rem;
        font-size: 16px; /* Prevents zoom on iOS */
    }

    .btn {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        width: 100%;
        margin-bottom: 0.5rem;
    }

    .d-flex.justify-content-between {
        flex-direction: column;
        gap: 1rem;
    }

    .d-flex.justify-content-between > div {
        width: 100%;
    }

    /* Staff selection mobile */
    #staff_checkboxes_container {
        padding: 1rem;
        max-height: 300px;
    }

    .staff-checkbox-item {
        padding: 0.875rem 1rem;
        margin-bottom: 0.5rem;
    }

    .form-label {
        font-size: 0.9rem;
    }

    h5 {
        font-size: 1.1rem;
    }

    /* Search row mobile */
    .row.align-items-end.mb-3 {
        gap: 1rem;
    }

    .row.align-items-end.mb-3 .col-md-8,
    .row.align-items-end.mb-3 .col-md-4 {
        width: 100%;
    }

    /* Stats row mobile */
    .d-flex.justify-content-between.align-items-center.mb-2 {
        flex-direction: column;
        gap: 0.5rem;
        text-align: center;
    }
}

@media (max-width: 576px) {
    .container-fluid {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
    }

    .card-body {
        padding: 1rem;
    }

    .card-header {
        padding: 1rem;
    }

    .card-title {
        font-size: 1.1rem;
    }

    .form-control, .form-select {
        padding: 0.675rem;
    }

    #staff_checkboxes_container {
        padding: 0.75rem;
        max-height: 250px;
    }

    .staff-checkbox-item {
        padding: 0.75rem;
    }

    .btn {
        padding: 0.675rem 1.25rem;
        font-size: 0.9rem;
    }

    h5 {
        font-size: 1rem;
    }

    .alert {
        padding: 0.875rem 1rem;
        font-size: 0.9rem;
    }
}

@media (max-width: 400px) {
    .container-fluid {
        padding-left: 0.25rem;
        padding-right: 0.25rem;
    }

    .card-body {
        padding: 0.75rem;
    }

    .form-control, .form-select {
        font-size: 16px; /* Ensure readable text on small screens */
    }

    .btn {
        font-size: 0.85rem;
        padding: 0.6rem 1rem;
    }

    .staff-checkbox-item {
        padding: 0.675rem;
    }

    .form-check-label {
        font-size: 0.9rem;
    }
}

/* ===== ACCESSIBILITY & UX ENHANCEMENTS ===== */
.form-control:disabled, .form-select:disabled {
    background-color: #f8f9fa;
    opacity: 0.7;
    cursor: not-allowed;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

/* Focus styles for accessibility */
.form-control:focus-visible,
.form-select:focus-visible,
.btn:focus-visible,
.form-check-input:focus-visible {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

/* Loading state for submit button */
.btn-loading {
    position: relative;
    color: transparent !important;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    top: 50%;
    left: 50%;
    margin-left: -10px;
    margin-top: -10px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Print styles */
@media print {
    .btn, .badge {
        display: none !important;
    }

    .card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }

    .card-header {
        background: #f8f9fa !important;
        color: #000 !important;
    }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .form-control, .form-select {
        border-width: 3px;
    }

    .btn {
        border-width: 2px;
    }

    .card {
        border: 2px solid #000;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    * {
        transition: none !important;
        animation: none !important;
    }

    .card-header::before {
        display: none;
    }
}

/* ===== CUSTOM UTILITY CLASSES ===== */
.text-wrap-break {
    word-wrap: break-word !important;
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    line-height: 1.4 !important;
}

.shadow-custom {
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1) !important;
}

.gradient-bg {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

/* Ensure all images are responsive */
img {
    max-width: 100%;
    height: auto;
}

/* Prevent horizontal scrolling */
body {
    overflow-x: hidden;
}
</style>


{% endblock %}